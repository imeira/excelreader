<script lang="javascript" src="dist/xlsx.full.min.js"></script>

<div class="component-container">
  <div class="inicio-container">
    <h2>Cadastro de Acordo em Lote</h2>
    <p>Escolha o arquivo em formato CSV pré-definido. Após carregar, valide os campos e seus respectivos valores e clique no botão "Cadastrar."</p>

    <div>
      <a id="download"> Clique aqui para baixar o Modelo do arquivo. </a>
    </div>
     <input type="file" (change)="onFileChange($event)" accept=".csv,.xls,.xlsx" multiple="false" />

    <div id="output"></div>
    <br>


<br><br>



<!-- Material table -->
<div class="card" *ngIf="dataSource.data && dataSource.data.length > 0">
  <h3 class="card-header text-center font-weight-bold text-uppercase py-4">{{titulo}}</h3>
 <div class="card-body">
   <div id="table" class="table-editable">
     <span class="table-add float-left mb-3 mr-2">
       <a class="text-success" (click)="add()">
         <mdb-icon fas icon="plus" size="2x"></mdb-icon>
       </a>
     </span>
      <table class="voxel-table mat-elevation-z8" mat-table matSort [dataSource]="dataSource">
        <ng-container matColumnDef="{{col}}" *ngFor="let col of displayedColumns">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>
            <span *ngIf="col !== '$$edit'">
              {{col}}
            </span>
            <span *ngIf="col == '$$edit'">
              Ações
            </span>
          </th>
          <td mat-cell *matCellDef="let element; let i = index;">
            <div *ngIf="!element.isEdit">
              <div class="btn-edit" *ngIf="col === '$$edit'; spanHeader" >
                <button (click)="element.isEdit = !element.isEdit">Editar</button>
                <span class="btn-remove">
                  <button (click)="remove(i)" color="danger">Remover</button>
                </span>
              </div>
              <span #spanHeader>
                {{element[col]}}
              </span>
            </div>
            <div *ngIf="element.isEdit">
              <div class="btn-edit" *ngIf="col === '$$edit'; else dateField">
                <button (click)="confirmEdit($event); element.isEdit = !element.isEdit">Confirmar</button>
                <!-- <button (click)="cancelEdit(); element.isEdit = !element.isEdit">Cancelar</button> -->
              </div>
              <ng-template #dateField>
                <mat-form-field appearance="fill" #elseDate *ngIf="dataSchema[col] === 'date'; else defaultField">
                  <mat-label>Choose a date</mat-label>
                  <input matInput [matDatepicker]="picker" value="{{element[col]}}">
                  <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                  <mat-datepicker #picker></mat-datepicker>
                </mat-form-field>
              </ng-template>
              <ng-template #defaultField>
                <mat-form-field>
                  <mat-label>{{col}}</mat-label>
                  <!-- <input type="{{dataSchema[col]}}" matInput value="{{element[col]}}" (blur)="updateList(i, col, $event)"> -->
                   <input (blur)="updateList(i, col, $event)" (keyup)="changeValue(i, col, $event)" type="{{dataSchema[col]}}" matInput value="{{element[col]}}">
                </mat-form-field>
              </ng-template>
            </div>
          </td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns; let i = index"></tr>
      </table>
    </div>
  </div>
</div>
<!-- Material table -->

<br><br>

<!-- Editable table -->
<!--
 <div class="card" *ngIf="csvRecords.length > 0">
   <h3 class="card-header text-center font-weight-bold text-uppercase py-4">{{titulo}}</h3>
  <div class="card-body">
    <div id="table" class="table-editable">
      <span class="table-add float-right mb-3 mr-2">
        <a class="text-success" (click)="add()">
          <mdb-icon fas icon="plus" size="2x"></mdb-icon>
        </a>
      </span>
      <table summary="Resultado CSV" class="table table-bordered table-responsive-md table-striped text-center">
        <tr>
        </tr>
        <tr>
          <th class="text-center">2- First Name</th>
          <th class="text-center">Last Name</th>
          <th class="text-center">Email</th>
          <th class="text-center">Phone Number</th>
          <th class="text-center">Title</th>
          <th class="text-center">Occupation</th>
          <th class="text-center">Ação</th>
        </tr>
        <tr *ngFor="let csvData of csvRecords; let id = index">
          <td>
            <span (keyup)="changeValue(id, 'firstName', $event)" (blur)="updateList(id, 'firstName', $event)" contenteditable="true">{{csvData.firstName}}</span>
          </td>
          <td>
            <span contenteditable="true" (keyup)="changeValue(id, 'lastName', $event)" (blur)="updateList(id, 'lastName', $event)">{{csvData.lastName}}</span>
          </td>
          <td>
            <span contenteditable="true" (keyup)="changeValue(id, 'email', $event)" (blur)="updateList(id, 'email', $event)">{{csvData.email}}</span>
          </td>
          <td>
            <span contenteditable="true" (keyup)="changeValue(id, 'phoneNumber', $event)" (blur)="updateList(id, 'phoneNumber', $event)">{{csvData.phoneNumber}}</span>
          </td>
          <td>
            <span contenteditable="true" (keyup)="changeValue(id, 'title', $event)" (blur)="updateList(id, 'title', $event)">{{csvData.title}}</span>
          </td>
          <td>
            <span contenteditable="true" (keyup)="changeValue(id, 'occupation', $event)" (blur)="updateList(id, 'occupation', $event)">{{csvData.occupation}}</span>
          </td>
          <td>
            <span class="table-remove">
              <button type="button" mdbBtn color="danger" rounded="true" size="sm" class="my-0" (click)="remove(id)">Remover</button>
            </span>
          </td>
        </tr>
      </table>
    </div>
  </div>
</div>
-->
<!-- Editable table -->



  </div>
</div>
